<h2>My Files</h2>

<div id="files"></div>
<button onclick="logout()">Logout</button>

<script src="js/auth.js"></script>

<script>
async function loadMyFiles() {
    const res = await fetch(API + "/my-files", {
        headers: { "Authorization": "Bearer " + getToken() }
    });

    const files = await res.json();
    const div = document.getElementById("files");

    div.innerHTML = "";

    files.forEach(f => {
        div.innerHTML += `
            <p>
                ${f.originalName} (${f.size} bytes) â€” ${f.privacy}
                <button onclick="downloadFile('${f._id}')">Download</button>
                <button onclick="deleteFile('${f._id}')">Delete</button>
            </p>
        `;
    });
}

async function downloadFile(id) {
    window.location.href = API + "/files/" + id + "/download";
}

async function deleteFile(id) {
    const res = await fetch(API + "/files/" + id, {
        method: "DELETE",
        headers: { "Authorization": "Bearer " + getToken() }
    });

    const out = await res.json();
    alert(out.message || out.error);
    loadMyFiles();
}

loadMyFiles();
</script>
